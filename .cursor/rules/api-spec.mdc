---
description: api spec
globs: 
alwaysApply: false
---
# ìµœì €ê°€ ê²€ìƒ‰ Agent API ëª…ì„¸ì„œ

## ğŸš€ Base URL
```
Development: http://localhost:8000
Production: https://api.videcoding.com
```

## ğŸ“‹ Core APIs

### 1. ìƒí’ˆ ê²€ìƒ‰ (ìŠ¤íŠ¸ë¦¬ë°)
ìƒí’ˆëª… ë˜ëŠ” URLë¡œ ìµœì €ê°€ë¥¼ ê²€ìƒ‰í•˜ê³  ì‹¤ì‹œê°„ìœ¼ë¡œ ê²°ê³¼ ìŠ¤íŠ¸ë¦¬ë°

```http
POST /api/search
Content-Type: application/json
```

**Request Body:**
```json
{
  "query": "ì•„ì´í° 15 Pro 256GB",
  "session_id": "optional-session-id",
  "options": {
    "include_shipping": true,
    "include_discounts": true,
    "max_sites": 5
  }
}
```

**Response (Streaming):**
```json
// ê²€ìƒ‰ ì‹œì‘
{"status": "searching", "message": "ğŸ” ìƒí’ˆ ê²€ìƒ‰ ì¤‘..."}

// ê° ì‡¼í•‘ëª° ê²°ê³¼ (ì‹¤ì‹œê°„)
{"status": "result", "site": "ì¿ íŒ¡", "price": 1350000, "shipping": 0, "url": "https://...", "is_lowest": false}
{"status": "result", "site": "11ë²ˆê°€", "price": 1380000, "shipping": 2500, "url": "https://...", "is_lowest": false}
{"status": "result", "site": "ì§€ë§ˆì¼“", "price": 1320000, "shipping": 0, "url": "https://...", "is_lowest": true}

// ìµœì¢… ê²°ê³¼
{"status": "complete", "lowest_price": {"site": "ì§€ë§ˆì¼“", "total_price": 1320000}, "summary": "ğŸ’¡ ì§€ë§ˆì¼“ì—ì„œ 1,320,000ì›ì´ ìµœì €ê°€ì…ë‹ˆë‹¤."}
```

### 2. ì„¸ì…˜ ê´€ë¦¬
ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬ë¥¼ ìœ„í•œ ì„¸ì…˜ API

```http
POST /api/session
```

**Response:**
```json
{
  "session_id": "sess_abc123",
  "created_at": "2024-01-15T10:30:00Z",
  "expires_at": "2024-01-15T11:30:00Z"
}
```

### 3. ê²€ìƒ‰ íˆìŠ¤í† ë¦¬
ì‚¬ìš©ìì˜ ì´ì „ ê²€ìƒ‰ ê¸°ë¡ ì¡°íšŒ

```http
GET /api/history/{session_id}
```

**Response:**
```json
{
  "session_id": "sess_abc123",
  "history": [
    {
      "query": "ì•„ì´í° 15 Pro",
      "timestamp": "2024-01-15T10:25:00Z",
      "lowest_price": {"site": "ì§€ë§ˆì¼“", "price": 1320000}
    }
  ]
}
```

### 4. í—¬ìŠ¤ì²´í¬
ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸

```http
GET /api/health
```

**Response:**
```json
{
  "status": "healthy",
  "version": "1.0.0",
  "timestamp": "2024-01-15T10:30:00Z"
}
```

## ğŸ”§ Error Responses

### 400 Bad Request
```json
{
  "error": "invalid_request",
  "message": "ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”",
  "details": {"field": "query", "code": "required"}
}
```

### 429 Too Many Requests
```json
{
  "error": "rate_limit_exceeded",
  "message": "ìš”ì²­ í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. 1ë¶„ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”",
  "retry_after": 60
}
```

### 500 Internal Server Error
```json
{
  "error": "internal_error",
  "message": "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤",
  "request_id": "req_abc123"
}
```

## ğŸ“Š Data Models

### SearchRequest
```python
class SearchRequest(BaseModel):
    query: str  # ìƒí’ˆëª… ë˜ëŠ” URL
    session_id: Optional[str] = None
    options: Optional[SearchOptions] = None

class SearchOptions(BaseModel):
    include_shipping: bool = True
    include_discounts: bool = True
    max_sites: int = 5
```

### SearchResult
```python
class SearchResult(BaseModel):
    site: str  # ì‡¼í•‘ëª°ëª…
    price: int  # ìƒí’ˆ ê°€ê²©
    shipping: int  # ë°°ì†¡ë¹„
    total_price: int  # ì´ ê°€ê²©
    url: str  # ìƒí’ˆ URL
    discount: Optional[int] = None  # í• ì¸ì•¡
    is_lowest: bool = False  # ìµœì €ê°€ ì—¬ë¶€
```

## ğŸ” Authentication

### API Key (ê°œë°œìš©)
```http
Authorization: Bearer your-api-key
```

### Rate Limiting
- **ì¼ë°˜ ì‚¬ìš©ì**: ë¶„ë‹¹ 10íšŒ
- **ì¸ì¦ ì‚¬ìš©ì**: ë¶„ë‹¹ 100íšŒ

## ğŸ“ Usage Examples

### cURL ì˜ˆì‹œ
```bash
# ìƒí’ˆ ê²€ìƒ‰
curl -X POST http://localhost:8000/api/search \
  -H "Content-Type: application/json" \
  -d '{"query": "ê°¤ëŸ­ì‹œ S24"}'

# í—¬ìŠ¤ì²´í¬
curl http://localhost:8000/api/health
```

### Python ì˜ˆì‹œ
```python
import httpx
import asyncio

async def search_product(query: str):
    async with httpx.AsyncClient() as client:
        async with client.stream(
            'POST', 
            'http://localhost:8000/api/search',
            json={'query': query}
        ) as response:
            async for line in response.aiter_lines():
                if line:
                    print(line)

# ì‚¬ìš©ë²•
asyncio.run(search_product("ì•„ì´í° 15"))
```

### JavaScript ì˜ˆì‹œ
```javascript
// Streamlitì—ì„œ ì‚¬ìš©
async function searchProduct(query) {
    const response = await fetch('/api/search', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({query})
    });
    
    const reader = response.body.getReader();
    while (true) {
        const {done, value} = await reader.read();
        if (done) break;
        console.log(new TextDecoder().decode(value));
    }
}
```

## ğŸš¦ Status Codes
- **200 OK**: ì„±ê³µ
- **400 Bad Request**: ì˜ëª»ëœ ìš”ì²­
- **429 Too Many Requests**: ìš”ì²­ í•œë„ ì´ˆê³¼
- **500 Internal Server Error**: ì„œë²„ ì˜¤ë¥˜

## ì°¸ê³  íŒŒì¼
- PRD: [prd.mdc](mdc:prd.mdc)
- ê¸°ìˆ  ìŠ¤íƒ: [tech-stack.mdc](mdc:tech-stack.mdc)
- ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜: [system-architecture.mdc](mdc:system-architecture.mdc)
