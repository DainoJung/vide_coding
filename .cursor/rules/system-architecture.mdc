---
description: system architecture
globs: 
alwaysApply: false
---
# ìµœì €ê°€ ê²€ìƒ‰ Agent ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

## ğŸ—ï¸ ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```mermaid
graph TB
    subgraph "ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ ê³„ì¸µ"
        UI[ì›¹ ì¸í„°í˜ì´ìŠ¤]
        Mobile[ëª¨ë°”ì¼ ì•±]
        API_Gateway[API Gateway]
    end
    
    subgraph "AI Agent ê³„ì¸µ"
        NLU[ìì—°ì–´ ì´í•´]
        Context[ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬]
        Orchestra[ê²€ìƒ‰ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°]
        Stream[ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì²˜ë¦¬]
    end
    
    subgraph "ê²€ìƒ‰ ì—”ì§„ ê³„ì¸µ"
        SearchCoord[ê²€ìƒ‰ ì½”ë””ë„¤ì´í„°]
        ParallelProc[ë³‘ë ¬ ì²˜ë¦¬ ì—”ì§„]
        ProductMatch[ìƒí’ˆ ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜]
        PriceCalc[ê°€ê²© ê³„ì‚° ì—”ì§„]
    end
    
    subgraph "ë°ì´í„° ìˆ˜ì§‘ ê³„ì¸µ"
        CoupangAPI[ì¿ íŒ¡ API]
        ElevenAPI[11ë²ˆê°€ í¬ë¡¤ëŸ¬]
        GmarketScraper[ì§€ë§ˆì¼“ ìŠ¤í¬ë˜í¼]
        NaverAPI[ë„¤ì´ë²„ì‡¼í•‘ API]
        OtherSites[ê¸°íƒ€ ì‡¼í•‘ëª°]
    end
    
    subgraph "ë°ì´í„° ì €ì¥ ê³„ì¸µ"
        Redis[Redis ìºì‹œ]
        MongoDB[MongoDB]
        SearchHistory[ê²€ìƒ‰ íˆìŠ¤í† ë¦¬]
        UserProfile[ì‚¬ìš©ì í”„ë¡œí•„]
    end
    
    subgraph "ì™¸ë¶€ ì„œë¹„ìŠ¤"
        RateLimiter[Rate Limiter]
        Monitor[ëª¨ë‹ˆí„°ë§]
        Analytics[ë¶„ì„ ì„œë¹„ìŠ¤]
    end
    
    %% ì—°ê²° ê´€ê³„
    UI --> API_Gateway
    Mobile --> API_Gateway
    API_Gateway --> NLU
    
    NLU --> Context
    NLU --> Orchestra
    Context --> MongoDB
    
    Orchestra --> SearchCoord
    Orchestra --> Stream
    Stream --> API_Gateway
    
    SearchCoord --> ParallelProc
    ParallelProc --> ProductMatch
    ParallelProc --> PriceCalc
    
    ProductMatch --> CoupangAPI
    ProductMatch --> ElevenAPI
    ProductMatch --> GmarketScraper
    ProductMatch --> NaverAPI
    ProductMatch --> OtherSites
    
    PriceCalc --> Redis
    Context --> Redis
    SearchCoord --> SearchHistory
    NLU --> UserProfile
    
    API_Gateway --> RateLimiter
    Orchestra --> Monitor
    ParallelProc --> Analytics
```

## ğŸ”„ ë°ì´í„° í”Œë¡œìš° ì•„í‚¤í…ì²˜

```mermaid
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant UI as ì›¹ ì¸í„°í˜ì´ìŠ¤
    participant Gateway as API Gateway
    participant Agent as AI Agent
    participant Search as ê²€ìƒ‰ ì—”ì§„
    participant Sites as ì‡¼í•‘ëª°ë“¤
    participant Cache as Redis ìºì‹œ
    participant DB as MongoDB
    
    User->>UI: ìƒí’ˆ ê²€ìƒ‰ ìš”ì²­
    UI->>Gateway: API í˜¸ì¶œ
    Gateway->>Agent: NLU ì²˜ë¦¬ ìš”ì²­
    
    Agent->>DB: ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ ì¡°íšŒ
    Agent->>Cache: ìºì‹œëœ ê²°ê³¼ í™•ì¸
    
    alt ìºì‹œëœ ê²°ê³¼ ì—†ìŒ
        Agent->>Search: ë³‘ë ¬ ê²€ìƒ‰ ì‹œì‘
        
        par ë³‘ë ¬ ê²€ìƒ‰
            Search->>Sites: ì¿ íŒ¡ ê²€ìƒ‰
            Search->>Sites: 11ë²ˆê°€ ê²€ìƒ‰  
            Search->>Sites: ì§€ë§ˆì¼“ ê²€ìƒ‰
            Search->>Sites: ë„¤ì´ë²„ì‡¼í•‘ ê²€ìƒ‰
        end
        
        Sites-->>Search: ìƒí’ˆ ì •ë³´ ì‘ë‹µ
        Search->>Search: ìƒí’ˆ ë§¤ì¹­ & ê°€ê²© ê³„ì‚°
        Search->>Cache: ê²°ê³¼ ìºì‹±
    end
    
    Search-->>Agent: ê²€ìƒ‰ ê²°ê³¼
    Agent->>Gateway: ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ
    Gateway-->>UI: ì‹¤ì‹œê°„ ê²°ê³¼ ì „ì†¡
    UI-->>User: ì‚¬ìš©ìì—ê²Œ í‘œì‹œ
    
    Agent->>DB: ê²€ìƒ‰ íˆìŠ¤í† ë¦¬ ì €ì¥
```

## ğŸ›ï¸ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜

```mermaid
graph LR
    subgraph "Frontend Services"
        WebApp[ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜]
        MobileApp[ëª¨ë°”ì¼ ì•±]
    end
    
    subgraph "API Gateway & Authentication"
        Gateway[API Gateway]
        Auth[ì¸ì¦ ì„œë¹„ìŠ¤]
        RateLimit[Rate Limiting]
    end
    
    subgraph "Core AI Services"
        NLPService[NLP ì„œë¹„ìŠ¤]
        ContextService[ì»¨í…ìŠ¤íŠ¸ ì„œë¹„ìŠ¤]
        StreamService[ìŠ¤íŠ¸ë¦¬ë° ì„œë¹„ìŠ¤]
    end
    
    subgraph "Search Services"
        SearchOrch[ê²€ìƒ‰ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°]
        ProductService[ìƒí’ˆ ë§¤ì¹­ ì„œë¹„ìŠ¤]
        PriceService[ê°€ê²© ê³„ì‚° ì„œë¹„ìŠ¤]
    end
    
    subgraph "Data Collection Services"
        CoupangService[ì¿ íŒ¡ ìˆ˜ì§‘ê¸°]
        ElevenService[11ë²ˆê°€ ìˆ˜ì§‘ê¸°]
        GmarketService[ì§€ë§ˆì¼“ ìˆ˜ì§‘ê¸°]
        NaverService[ë„¤ì´ë²„ ìˆ˜ì§‘ê¸°]
    end
    
    subgraph "Data & Cache Layer"
        RedisCluster[Redis Cluster]
        MongoCluster[MongoDB Cluster]
        ElasticSearch[ê²€ìƒ‰ ì¸ë±ìŠ¤]
    end
    
    subgraph "Infrastructure"
        LoadBalancer[ë¡œë“œ ë°¸ëŸ°ì„œ]
        MessageQueue[ë©”ì‹œì§€ í]
        Monitoring[ëª¨ë‹ˆí„°ë§]
    end
    
    %% ì—°ê²°
    WebApp --> LoadBalancer
    MobileApp --> LoadBalancer
    LoadBalancer --> Gateway
    Gateway --> Auth
    Gateway --> RateLimit
    
    Gateway --> NLPService
    Gateway --> StreamService
    NLPService --> ContextService
    
    ContextService --> SearchOrch
    SearchOrch --> ProductService
    SearchOrch --> PriceService
    
    ProductService --> CoupangService
    ProductService --> ElevenService  
    ProductService --> GmarketService
    ProductService --> NaverService
    
    PriceService --> RedisCluster
    ContextService --> MongoCluster
    ProductService --> ElasticSearch
    
    SearchOrch --> MessageQueue
    MessageQueue --> Monitoring
```

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

```mermaid
erDiagram
    User {
        string user_id PK
        string name
        string email
        json preferences
        datetime created_at
        datetime updated_at
    }
    
    SearchSession {
        string session_id PK
        string user_id FK
        json conversation_history
        datetime created_at
        datetime expires_at
    }
    
    SearchHistory {
        string history_id PK
        string user_id FK
        string session_id FK
        string query
        json search_results
        datetime searched_at
    }
    
    Product {
        string product_id PK
        string name
        string brand
        string category
        json specifications
        datetime created_at
    }
    
    PriceData {
        string price_id PK
        string product_id FK
        string site_name
        decimal price
        decimal shipping_cost
        json discounts
        string product_url
        datetime collected_at
    }
    
    Cache {
        string cache_key PK
        json data
        datetime expires_at
    }
    
    User ||--o{ SearchSession : creates
    User ||--o{ SearchHistory : has
    SearchSession ||--o{ SearchHistory : contains
    Product ||--o{ PriceData : has_prices
```

## ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ ë° êµ¬ì„± ìš”ì†Œ

### Frontend
- **ì›¹**: React.js + TypeScript + TailwindCSS
- **ëª¨ë°”ì¼**: React Native ë˜ëŠ” Flutter
- **ìƒíƒœ ê´€ë¦¬**: Redux Toolkit / Zustand
- **ì‹¤ì‹œê°„ í†µì‹ **: WebSocket / Server-Sent Events

### Backend Services
- **API Gateway**: Kong ë˜ëŠ” AWS API Gateway
- **ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤**: Node.js + Express / Python + FastAPI
- **AI/NLP**: Python + Transformers + OpenAI API
- **ê²€ìƒ‰ ì—”ì§„**: Elasticsearch + Redis

### Data Layer
- **ìºì‹œ**: Redis Cluster (ì„¸ì…˜, ê²€ìƒ‰ ê²°ê³¼)
- **ì£¼ ë°ì´í„°ë² ì´ìŠ¤**: MongoDB (ì‚¬ìš©ì, íˆìŠ¤í† ë¦¬)
- **ê²€ìƒ‰ ì¸ë±ìŠ¤**: Elasticsearch (ìƒí’ˆ ì •ë³´)
- **ë©”ì‹œì§€ í**: RabbitMQ / Apache Kafka

### Infrastructure
- **ì»¨í…Œì´ë„ˆ**: Docker + Kubernetes
- **CI/CD**: GitHub Actions / Jenkins
- **ëª¨ë‹ˆí„°ë§**: Prometheus + Grafana
- **ë¡œê·¸**: ELK Stack (Elasticsearch, Logstash, Kibana)

### External Services  
- **ì‡¼í•‘ëª° API**: ê° ì‡¼í•‘ëª° ê³µì‹ API
- **ì›¹ ìŠ¤í¬ë˜í•‘**: Playwright / Selenium
- **í´ë¼ìš°ë“œ**: AWS / Google Cloud Platform

## ğŸš€ í™•ì¥ì„± ë° ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­

### ìˆ˜í‰ í™•ì¥
- **ë¡œë“œ ë°¸ëŸ°ì‹±**: íŠ¸ë˜í”½ ë¶„ì‚° ì²˜ë¦¬
- **ì˜¤í†  ìŠ¤ì¼€ì¼ë§**: ë¶€í•˜ì— ë”°ë¥¸ ìë™ í™•ì¥
- **CDN**: ì •ì  ë¦¬ì†ŒìŠ¤ ì „ì—­ ë°°í¬

### ì„±ëŠ¥ ìµœì í™”
- **ìºì‹± ì „ëµ**: ë‹¤ì¸µ ìºì‹œ êµ¬ì¡°
- **ë³‘ë ¬ ì²˜ë¦¬**: ë¹„ë™ê¸° ë©€í‹°ìŠ¤ë ˆë”©
- **ë°ì´í„° ì••ì¶•**: ì‘ë‹µ ë°ì´í„° ìµœì í™”

### ì¥ì•  ëŒ€ì‘
- **Circuit Breaker**: ì¥ì•  ì „íŒŒ ë°©ì§€
- **Retry ë¡œì§**: ì¼ì‹œì  ì¥ì•  ëŒ€ì‘
- **Fallback**: ëŒ€ì²´ ì„œë¹„ìŠ¤ ì œê³µ

## ì°¸ê³  íŒŒì¼
- PRD: [prd.mdc](mdc:prd.mdc)
- ì™€ì´ì–´í”„ë ˆì„: [wireframe.md](mdc:docs/wireframe.md)
- ë¬¸ì œ ì •ì˜: [problem-definition.mdc](mdc:problem-definition.mdc)
- ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤: [user-scenarios.mdc](mdc:user-scenarios.mdc)
